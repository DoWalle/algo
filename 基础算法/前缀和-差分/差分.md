
# [差分](https://oi-wiki.org/basic/prefix-sum/)

差分是一种和前缀和相对的策略，可以当做是求和的逆运算。

差分数组可由前缀和数组算出：
$$
diff[i] = 
\begin{cases}
preSum[i]-preSum[i-1] & i>1 \\
preSum[i] & i=0
\end{cases}
$$

则差分数组从0累加到第n项，也是第n项前缀和为：

$$
\begin{align}
\sum\limits_{i=0}^{n}diff[i] &= preSum[0] + preSum[1]-preSum[0] + ...+preSum[n] - preSum[n-1] \\
&= preSum[n]
\end{align}
$$

preSum 也可算前缀和：
$$
preSumSum[n] = \sum\limits_{i=1}^{n}preSum[i] = \sum\limits_{i=1}^{n}\sum\limits_{j=1}^{i}diff[j] = \sum\limits_{i=1}^{n}(n-i+1)diff[i]
$$

## 差分数组的性质

对**差分数组内区间两端**进行操作以代替**前缀和数组内整个区间**的操作，**时间复杂度从O(k)降至O(1)）**

一个区间`[i, i+k-1]`，区间长度为`k`

在差分数组内区间首元素`diff[i]`加上变化量`△`，区间尾元素的下一位`diff[i+k]`减上变化量`△`，就可以算出差分数组
$$
\begin{cases} diff[i]+\triangle \\ 
diff[i+k]-\triangle 
\end{cases}
$$

应用前缀和公式，就可以算出前缀和数组
$$
pre\_sum[i] = pre\_sum[i-1]+diff[i]
$$

**证明**

前缀和数组preSum在区间长度为 k 的 [i, i+k-1] 范围内的元素都加一

可以看出差分数组区间内的首元素加一 `diff[i]+1`，末元素的下一位减一 `diff[i+k]-1`

| preSum(原来)   | diff(原来)                  | preSum(加一后)      | diff(加一后)                                |
| -------------- | --------------------------- | ------------------- | ------------------------------------------- |
| preSum[i-1]    | preSum[i-1]-preSum[i-2]     | preSum[i-1]         | preSum[i-1]-preSum[i-2]=diff[i-1]           |
| preSum[i]      | preSum[i]-preSum[i-1]       | **preSum[i]+1**     | **preSum[i]+1-preSum[i-1]=diff[i]+1**       |
| preSum[i+1]    | preSum[i+1]-preSum[i]       | **preSum[i+1]+1**   | preSum[i+1]+1-preSum[i]-1=diff[i+1]         |
| ...            | ...                         | ...                 | ...                                         |
| preSum[ i+k-2] | preSum[i+k-2]-preSum[i+k-3] | **preSum[i+k-2]+1** | preSum[i+k-2]+1-preSum[i+k-3]+1=diff[i+k-2] |
| preSum[ i+k-1] | preSum[i+k-1]-preSum[i+k-2] | **preSum[i+k-1]+1** | preSum[i+k-1]+1-preSum[i+k-2]+1=diff[i+k-1] |
| preSum[ i+k]   | preSum[i+k]-preSum[i+k-1]   | preSum[i+k**]**     | **preSum[i+k]-preSum[i+k-1]+1=diff[i+k]-1** |

前缀和数组内区间元素整体加一，而在差分数组内区间只是两端变化（首元素加一，末元素的下一位减一）

## 例题

[1109-[差分]-航班预订统计](./例题/1109-[差分]-航班预订统计.md)

[995-[差分数组]-K 连续位的最小翻转次数](./例题/995-[差分数组]-K 连续位的最小翻转次数.md)

